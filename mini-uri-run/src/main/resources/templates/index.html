<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>短链接生成</title>
    <!-- 仅保留自定义脚本，使用原生实现 -->
    <script defer th:src="@{/static/js/request.js}"></script>
    <script defer th:src="@{/static/js/api.js}"></script>
    <link rel="icon" th:href="@{/static/img/favicon.ico}">
    <link rel="stylesheet" th:href="@{/static/css/base.css}">
</head>
<body>
<div class="box">
    <div>
        <label for="long" class="inp">
            <input type="text" id="long" placeholder="&nbsp;">
            <span class="label">长链接</span>
            <span class="focus-bg"></span>
        </label>
    </div>
    <div style="margin-top: 15px;margin-bottom: 15px">
        <label> 有效时间:
            <input type="radio" id="1" name="expirationTime" value="1" checked> 1天
            <input type="radio" id="7" name="expirationTime" value="7"> 7天
            <input type="radio" id="30" name="expirationTime" value="30"> 1个月
            <input type="radio" id="90" name="expirationTime" value="90"> 3个月
        </label>
    </div>
    <button type="button" id="generate">生成短链接</button>
    <div style="text-align: center;">
        <label for="short" class="inp short">
            <input type="text" id="short" placeholder="&nbsp;">
            <span class="label">短链接</span>
            <span class="focus-bg"></span>
        </label>
        <button type="button" id="copy" style="width:100px;">Copy</button>
    </div>
</div>
<script>
    window.addEventListener('DOMContentLoaded', function () {
        const btnGenerate = document.getElementById('generate');
        const inputLong = document.getElementById('long');
        const inputShort = document.getElementById('short');
        const btnCopy = document.getElementById('copy');

        btnGenerate.addEventListener('click', function () {
            const originalUrl = inputLong.value.trim();
            const checked = document.querySelector('input[name="expirationTime"]:checked');
            const expireTime = checked ? checked.value : '1';
            if (!originalUrl) {
                alert('请输入原始链接');
                return;
            }
            generateUri({
                originalUrl: originalUrl,
                expireTime: expireTime
            }).then(function (res) {
                if (res && res.code === 200) {
                    inputShort.value = res.data || '';
                } else {
                    alert(res && (res.msg || res.message) || '生成失败');
                }
            }).catch(function (err) {
                alert(err && err.message ? err.message : String(err));
            });
        });

        btnCopy.addEventListener('click', function () {
            const text = inputShort.value || '';
            if (!text) {
                alert('没有可复制的内容');
                return;
            }
            if (navigator.clipboard && typeof navigator.clipboard.writeText === 'function') {
                navigator.clipboard.writeText(text).then(function () {
                    btnCopy.textContent = 'Copied!';
                    setTimeout(function () { btnCopy.textContent = 'Copy'; }, 2000);
                }).catch(function () {
                    fallbackCopy();
                });
            } else {
                fallbackCopy();
            }
        });

        function fallbackCopy() {
            inputShort.select();
            try {
                const ok = document.execCommand('copy');
                if (ok) {
                    btnCopy.textContent = 'Copied!';
                    setTimeout(function () { btnCopy.textContent = 'Copy'; }, 2000);
                } else {
                    alert('复制失败，请手动复制');
                }
            } catch (e) {
                alert('复制失败，请手动复制');
            } finally {
                window.getSelection && window.getSelection().removeAllRanges();
                inputShort.blur();
            }
        }
    });
</script>
</body>
</html>
